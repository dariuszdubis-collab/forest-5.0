{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Logging Event Schema",
  "type": "object",
  "properties": {
    "timestamp": {"type": "string", "format": "date-time"},
    "level": {"type": "string"},
    "symbol": {"type": "string"},
    "action": {"type": "string"},
    "side": {"type": "string"},
    "qty": {"type": "number"},
    "price": {"type": "number"},
    "latency_ms": {"type": "number"},
    "error": {"type": ["string", "null"]},
    "context": {"type": ["object", "null"]},
    "decision": {
      "type": ["object", "null"],
      "properties": {
        "votes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "source": {"type": "string"},
              "direction": {"type": ["string", "number"]},
              "weight": {"type": "number"},
              "score": {"type": "number"}
            },
            "required": ["source", "direction", "weight", "score"]
          }
        },
        "weight_sum": {"type": "number"}
      },
      "required": ["votes", "weight_sum"]
    }
  },
  "required": [
    "timestamp",
    "level",
    "symbol",
    "action",
    "side",
    "qty",
    "price",
    "latency_ms",
    "error",
    "context"
  ],
  "definitions": {
    "setup_trigger": {
      "type": "object",
      "properties": {
        "event": {"const": "setup_trigger"},
        "trigger_price": {"type": "number"},
        "fill_price": {"type": "number"},
        "slippage": {"type": "number"},
        "setup_id": {"type": "string"},
        "action": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"}
      },
      "required": [
        "event",
        "trigger_price",
        "fill_price",
        "slippage",
        "setup_id",
        "action",
        "entry",
        "sl",
        "tp"
      ]
    },
    "setup_expire": {
      "type": "object",
      "properties": {
        "event": {"const": "setup_expire"},
        "reason": {"type": "string"}
      },
      "required": ["event", "reason"]
    }
  }
}
