{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Logging Event Schema",
  "type": "object",
  "properties": {
    "timestamp": {"type": "string", "format": "date-time"},
    "level": {"type": "string"},
    "symbol": {"type": "string"},
    "action": {"type": "string"},
    "run_id": {"type": ["string", "null"]},
    "setup_id": {"type": ["string", "null"]},
    "client_order_id": {"type": ["string", "null"]},
    "ticket": {"type": ["number", "null"]},
    "side": {"type": "string"},
    "entry": {"type": ["number", "null"]},
    "sl": {"type": ["number", "null"]},
    "tp": {"type": ["number", "null"]},
    "qty": {"type": "number"},
    "price": {"type": "number"},
    "reason": {"type": ["string", "null"]},
    "ts": {"type": ["number", "null"]},
    "latency_ms": {"type": "number"},
    "error": {"type": ["string", "null"]},
    "context": {"type": ["object", "null"]},
    "path": {"type": "string"},
    "separator": {"type": "string"},
    "decimal": {"type": "string"},
    "has_header": {"type": "boolean"},
    "aliases": {"type": "object"},
    "rows": {"type": "integer"},
    "from": {"type": ["string", "null"]},
    "to": {"type": ["string", "null"]},
    "policy": {"type": "string"},
    "count": {"type": "integer"},
    "gaps_preview": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "start": {"type": "string"},
          "end": {"type": "string"},
          "delta": {"type": "string"},
          "bars_missing": {"type": "integer"}
        },
        "required": ["start", "end", "delta", "bars_missing"]
      }
    },
    "decision": {
      "type": ["object", "null"],
      "properties": {
        "votes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "source": {"type": "string"},
              "direction": {"type": ["string", "number"]},
              "weight": {"type": "number"},
              "score": {"type": "number"}
            },
            "required": ["source", "direction", "weight", "score"]
          }
        },
        "weight_sum": {"type": "number"}
      },
      "required": ["votes", "weight_sum"]
    }
  },
  "required": [
    "timestamp",
    "level",
    "symbol",
    "action",
    "side",
    "qty",
    "price",
    "latency_ms",
    "error",
    "context"
  ],
  "definitions": {
    "setup_trigger": {
      "type": "object",
      "properties": {
        "event": {"const": "setup_trigger"},
        "setup_id": {"type": "string"},
        "action": {"type": "string"},
        "trigger_price": {"type": "number"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "fill_price": {"type": "number"},
        "slippage": {"type": "number"},
        "reason": {"type": "string"}
      },
      "required": [
        "event",
        "setup_id",
        "action",
        "trigger_price",
        "entry",
        "sl",
        "tp"
      ]
    },
    "setup_expire": {
      "type": "object",
      "properties": {
        "event": {"const": "setup_expire"},
        "setup_id": {"type": "string"},
        "action": {"type": "string"},
        "trigger_price": {"type": "number"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "fill_price": {"type": "number"},
        "slippage": {"type": "number"},
        "reason": {"type": "string"}
      },
      "required": ["event"]
    }
    ,
    "order_submitted": {
      "type": "object",
      "properties": {
        "event": {"const": "order_submitted"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "order_ack": {
      "type": "object",
      "properties": {
        "event": {"const": "order_ack"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "order_filled": {
      "type": "object",
      "properties": {
        "event": {"const": "order_filled"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "order_rejected": {
      "type": "object",
      "properties": {
        "event": {"const": "order_rejected"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "order_timeout": {
      "type": "object",
      "properties": {
        "event": {"const": "order_timeout"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "order_retry": {
      "type": "object",
      "properties": {
        "event": {"const": "order_retry"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "broker_adjusted_stops": {
      "type": "object",
      "properties": {
        "event": {"const": "broker_adjusted_stops"},
        "run_id": {"type": "string"},
        "setup_id": {"type": "string"},
        "client_order_id": {"type": "string"},
        "ticket": {"type": "number"},
        "side": {"type": "string"},
        "entry": {"type": "number"},
        "sl": {"type": "number"},
        "tp": {"type": "number"},
        "qty": {"type": "number"},
        "reason": {"type": "string"},
        "ts": {"type": "number"}
      },
      "required": ["event"]
    },
    "data_csv_schema": {
      "type": "object",
      "properties": {
        "event": {"const": "data_csv_schema"},
        "path": {"type": "string"},
        "separator": {"type": "string"},
        "decimal": {"type": "string"},
        "has_header": {"type": "boolean"},
        "aliases": {"type": "object"},
        "rows": {"type": "integer"},
        "from": {"type": ["string", "null"]},
        "to": {"type": ["string", "null"]}
      },
      "required": ["event"]
    },
    "data_time_gaps": {
      "type": "object",
      "properties": {
        "event": {"const": "data_time_gaps"},
        "policy": {"type": "string"},
        "count": {"type": "integer"},
        "gaps_preview": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "start": {"type": "string"},
              "end": {"type": "string"},
              "delta": {"type": "string"},
              "bars_missing": {"type": "integer"}
            },
            "required": ["start", "end", "delta", "bars_missing"]
          }
        }
      },
      "required": ["event"]
    }
  }
}
